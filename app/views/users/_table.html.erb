<%= turbo_frame_tag 'users-table' do %>
  <%= render TableComponent.new(
    columns: [
      { 
        key: :email_address, 
        label: t('users.columns.email'), 
        sortable: true,
        priority: :high,
        truncate: true
      },
      {
        key: :status,
        label: t('users.columns.status'),
        sortable: false,
        priority: :high,
        format: ->(user) { auto_status_badge(user.status) }
      },
      {
        key: :created_at,
        label: t('users.columns.created_at'),
        type: :datetime,
        sortable: true,
        priority: :normal
      },
      {
        key: :updated_at,
        label: t('users.columns.updated_at'),
        type: :datetime,
        sortable: true,
        priority: :low
      }
    ],
    data: users,
    pagy: pagy,
    sort_column: custom_params["sort"],
    sort_direction: custom_params["direction"],
    empty_message: t('users.index.empty_message', default: 'No users found. Create your first user to get started.'),
    selectable: true,
    selected_ids: custom_params["selected_ids"] || [],
    dom_id: ->(user) { dom_id(user) },
    record_id: ->(user) { user.hashid },
    row_actions: [
      {
        label: t('common.actions.view'),
        icon: "eye",
        url: ->(user) { user_path(user) },
        type: :link,
        data: { 
          turbo_frame: "modal-content",
          modal_title_param: t('users.show.title', default: 'User Details'),
          modal_size: "lg"
        }
      },
      {
        label: t('common.actions.edit'),
        icon: "pencil",
        url: ->(user) { edit_user_path(user) },
        type: :link,
        data: { 
          turbo_frame: "modal-content",
          modal_title_param: t('users.edit.title', default: 'Edit User'),
          modal_size: "md"
        }
      },
      {
        label: t('common.actions.delete'),
        icon: "trash-2",
        url: ->(user) { user_path(user) },
        type: :button,
        method: :delete,
        data: { turbo_confirm: t('users.messages.confirm_delete', default: 'Are you sure you want to delete this user?') }
      }
    ]
  ) %>
  <% if pagy %>
    <%= render PagyComponent.new(
      pagy: pagy,
      form_id: "filter-form"
    ) %>
  <% end %>
<% end %>
