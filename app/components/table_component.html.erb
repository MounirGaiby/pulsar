<div class="table-container">
  <div class="overflow-visible bg-base-100 rounded-box shadow-xs border border-base-200/60">
    <table id="<%= @table_id %>" class="<%= responsive_classes %> overflow-auto" data-controller="table" data-table-sort-column-value="<%= @sort_column %>" data-table-sort-direction-value="<%= @sort_direction %>">
      <thead>
        <tr>
          <% if @selectable %>
            <th class="px-4 py-3 text-left font-medium border-b border-base-300">
              <label class="flex items-center gap-2">
                <input type="checkbox" class="checkbox checkbox-sm" <%= "checked" if all_selected? %> data-action="table#toggleSelectAll">
                <span class="ml-3 text-sm"><%= t('table.select_all', default: 'Select All') %></span>
              </label>
            </th>
          <% end %>
          <% @columns.each do |column| %>
            <% if sortable?(column) %>
              <th class="<%= header_classes(column) %>" data-action="click->table#sort" data-table-column="<%= h(column.key) %>">
                <div class="flex items-center justify-between w-full group/header">
                  <span><%= column.label %></span>
                  <%= icon sort_icon(column), library: "lucide", class: "w-4 h-4 #{sorted_by?(column) ? 'text-base-content/60' : 'text-base-content/40 group-hover/header:text-base-content/60'} flex-shrink-0 transition-colors duration-200" %>
                </div>
              </th>
            <% else %>
              <th class="<%= header_classes(column) %>">
                <div class="flex items-center justify-between w-full">
                  <span><%= column.label %></span>
                </div>
              </th>
            <% end %>
          <% end %>
          <% if has_row_actions? %>
            <th class="px-4 py-3 text-center font-medium border-b border-base-300">
              <span class="text-sm"><%= t('table.actions', default: 'Actions') %></span>
            </th>
          <% end %>
        </tr>
      </thead>
      <tbody class="divide-y divide-base-200/30">
        <% if @data.any? %>
          <% @data.each do |record| %>
            <tr class="hover:bg-gradient-to-r hover:from-base-50/50 hover:to-transparent transition-all duration-200 group <%= "selected" if record_selected?(record) %>">
              <% if @selectable %>
                <td class="px-4 py-3 border-b border-base-200/50">
                  <input type="checkbox" class="checkbox checkbox-sm" <%= "checked" if record_selected?(record) %> data-action="table#toggleSelect" data-table-record-id="<%= record_id(record) %>">
                </td>
              <% end %>
              <% @columns.each do |column| %>
                <td class="<%= cell_classes(column) %>">
                  <%= cell_value(record, column) %>
                </td>
              <% end %>
              <% if has_row_actions? %>
                <td class="px-4 py-3 border-b border-base-200/50 flex justify-end">
                  <%# Inline dropdown so the markup and actions are visible in the template %>
                  <% direction = I18n.locale == :ar ? :rtl : :ltr %>
                  <%= render DropdownComponent.new(direction: direction, container_classes: "dropdown-left !overflow-visible", dropdown_classes: "btn btn-ghost btn-sm", menu_classes: "bg-base-100") do |dropdown| %>
                    <% dropdown.with_trigger do %>
                      <%= icon "ellipsis-vertical", library: "lucide", class: "w-4 h-4" %>
                    <% end %>
                    <% dropdown.with_menu do %>
                      <% @row_actions.each do |action| %>
                        <li>
                          <% if action[:type] == :link %>
                            <%= link_to (action[:url].respond_to?(:call) ? action[:url].call(record) : action[:url]), class: "flex items-center gap-2" do %>
                              <%= icon action[:icon], library: "lucide", class: "w-4 h-4" if action[:icon] %>
                              <span class="text-sm"><%= action[:label] %></span>
                            <% end %>
                          <% elsif action[:type] == :button %>
                            <%= button_to (action[:url].respond_to?(:call) ? action[:url].call(record) : action[:url]), method: action[:method] || :post, form: { data: action[:data] || {} }, class: "w-full text-left" do %>
                              <span class="flex items-center gap-2"><%= icon action[:icon], library: "lucide", class: "w-4 h-4" if action[:icon] %><span class="text-sm"><%= action[:label] %></span></span>
                            <% end %>
                          <% end %>
                        </li>
                      <% end %>
                    <% end %>
                  <% end %>
                </td>
              <% end %>
            </tr>
          <% end %>
        <% else %>
          <tr>
            <td colspan="<%= @columns.size + (@selectable ? 1 : 0) + (has_row_actions? ? 1 : 0) %>" class="<%= empty_row_classes %>">
              <div class="flex flex-col items-center gap-3 py-12">
                <%= icon "inbox", library: "lucide", class: "w-12 h-12 text-base-content/20" %>
                <span class="text-lg font-medium text-base-content/60"><%= @empty_message %></span>
                <span class="text-sm text-base-content/40"><%= t('table.no_data_available', default: 'No data available') %></span>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
</div>